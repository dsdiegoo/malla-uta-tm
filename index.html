<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Malla TM Imagenolog√≠a UTA</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --uta-primary: #1C305E; --uta-dark: #0f1c3a;
            --bg-body: #f1f5f9;
            --st-pending-bg: #ffffff; --st-pending-border: #cbd5e1; --st-pending-text: #94a3b8;
            --st-taking-bg: #fffbeb; --st-taking-border: #f59e0b; --st-taking-text: #b45309;
            --st-approved-bg: #f0fdf4; --st-approved-border: #15803d; --st-approved-text: #14532d; --st-approved-fill: #16a34a; 
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-body); color: #1e293b; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        header { background: var(--uta-primary); color: white; padding: 12px 16px; display: flex; flex-direction: column; gap: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); z-index: 100; flex-shrink: 0; }
        .header-top h1 { font-size: 0.85rem; font-weight: 700; margin: 0; text-transform: uppercase; }
        .header-top p { font-size: 0.65rem; opacity: 0.7; margin: 0; }
        .toolbar { display: flex; gap: 8px; overflow-x: auto; padding: 4px 0; scrollbar-width: none; }
        .toolbar::-webkit-scrollbar { display: none; }
        .btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); color: white; padding: 6px 12px; border-radius: 50px; font-size: 0.7rem; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px; white-space: nowrap; }
        .btn.active { background: white; color: var(--uta-primary); }
        .btn-reset { background: rgba(220, 38, 38, 0.8); margin-left: auto; }
        
        .main-content { flex: 1; position: relative; background: var(--bg-body); overflow: hidden; }
        .view-section { display: none; width: 100%; height: 100%; overflow: auto; padding-bottom: 40px; }
        .view-section.active { display: block; }
        
        /* GRID HORIZONTAL */
        .grid-wrapper { padding: 15px; overflow-x: auto; height: 100%; display: flex; align-items: flex-start; }
        .grid-horizontal { display: flex; gap: 12px; padding-right: 20px; }
        .semester-col { width: 145px; display: flex; flex-direction: column; gap: 8px; flex-shrink: 0; }
        .sem-header { background: white; color: var(--uta-primary); padding: 8px; border-radius: 8px; text-align: center; border: 1px solid #e2e8f0; display: flex; flex-direction: column; gap: 4px; }
        .sem-title { font-size: 0.7rem; font-weight: 800; text-transform: uppercase; }
        .btn-approve-sem { background: transparent; border: 1px solid var(--st-approved-border); color: var(--st-approved-border); font-size: 0.6rem; border-radius: 4px; cursor: pointer; padding: 3px; font-weight: 700; }
        .btn-approve-sem:hover { background: var(--st-approved-fill); color: white; }
        
        .card { background: white; padding: 10px 8px; border-radius: 8px; font-size: 0.65rem; line-height: 1.3; font-weight: 500; color: var(--st-pending-text); border: 1px solid var(--st-pending-border); cursor: pointer; display: flex; gap: 6px; align-items: flex-start; min-height: 50px; position: relative; }
        .card:active { transform: scale(0.98); }
        .card-icon { font-size: 0.9rem; min-width: 15px; margin-top: 1px; }
        .card-text { width: 100%; word-break: break-word; }
        .card[data-status="taking"] { background: var(--st-taking-bg); border-color: var(--st-taking-border); color: var(--st-taking-text); }
        .card[data-status="taking"]::before { content:''; position: absolute; left:0; top:0; bottom:0; width:3px; background: var(--st-taking-border); border-radius: 4px 0 0 4px; }
        .card[data-status="approved"] { background: var(--st-approved-bg); border-color: var(--st-approved-border); color: var(--st-approved-text); font-weight: 600; }
        .card[data-status="approved"]::after { content: '‚úî'; position: absolute; top: 4px; right: 4px; font-size: 0.6rem; color: var(--st-approved-border); }

        /* DASHBOARD */
        .dashboard-container { padding: 20px; max-width: 600px; margin: 0 auto; }
        .dash-summary { background: white; border-radius: 16px; padding: 20px; margin-bottom: 25px; display: flex; align-items: center; justify-content: space-between; border: 1px solid #e2e8f0; }
        .dash-percent { font-size: 2.2rem; font-weight: 800; color: var(--uta-primary); line-height: 1; }
        .dash-bar-bg { width: 120px; height: 6px; background: #f1f5f9; border-radius: 10px; margin-top: 5px; overflow: hidden; }
        .dash-bar-fill { height: 100%; background: var(--st-approved-fill); width: 0%; transition: width 0.8s ease; }
        .years-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; }
        .year-card { background: white; border-radius: 12px; padding: 15px; border: 1px solid #e2e8f0; display: flex; flex-direction: column; align-items: center; gap: 12px; }
        .year-title { font-size: 0.7rem; font-weight: 800; color: var(--uta-primary); text-transform: uppercase; border-bottom: 2px solid #f1f5f9; padding-bottom: 5px; width: 100%; text-align: center; }
        .sem-circles-pair { display: flex; gap: 15px; }
        .sem-circle { width: 45px; height: 45px; border-radius: 50%; background: #f1f5f9; color: #94a3b8; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.9rem; font-weight: 700; }
        .sem-circle span { font-size: 0.4rem; font-weight: 600; text-transform: uppercase; }
        .sem-circle.c-taking { background: var(--st-taking-border); color: white; transform: scale(1.1); }
        .sem-circle.c-approved { background: var(--st-approved-fill); color: white; }

        /* BACKUP SECTION */
        .backup-area { margin-top: 30px; padding: 20px; background: #e2e8f0; border-radius: 12px; text-align: center; }
        .backup-btn { background: #475569; color: white; border: none; padding: 8px 16px; border-radius: 6px; font-size: 0.75rem; cursor: pointer; margin: 5px; }
        .summary-mode .card[data-status="pending"], .summary-mode .semester-col.empty-semester { display: none; }
    </style>
</head>
<body>
<header>
    <div class="header-top"><h1>Tecnolog√≠a M√©dica: Imagenolog√≠a y F√≠sica M√©dica</h1><p>Universidad de Tarapac√°</p></div>
    <div class="toolbar">
        <button class="btn active" id="btnList" onclick="switchView('list')">üìã Malla</button>
        <button class="btn" id="btnYears" onclick="switchView('years')">üéì Progreso</button>
        <button class="btn" id="btnSummary" onclick="toggleSummaryMode()">üì∑ Resumen</button>
        <button class="btn btn-reset" onclick="resetAll()">üóëÔ∏è</button>
    </div>
</header>
<div class="main-content">
    <div id="listView" class="view-section active"><div class="grid-wrapper" id="gridWrapper"><div class="grid-horizontal" id="gridContainer"></div></div></div>
    <div id="yearsView" class="view-section">
        <div class="dashboard-container">
            <div class="dash-summary">
                <div><h2>Avance Global</h2><span style="font-size:0.65rem;color:#94a3b8">Total Carrera</span></div>
                <div style="text-align: right;"><div class="dash-percent" id="dashPercent">0%</div><div class="dash-bar-bg"><div class="dash-bar-fill" id="dashFill"></div></div></div>
            </div>
            <div class="years-grid" id="yearsGrid"></div>
            
            <div class="backup-area">
                <h3 style="margin:0 0 10px 0; font-size:0.8rem; color:#475569;">‚òÅÔ∏è Copia de Seguridad</h3>
                <button class="backup-btn" onclick="exportData()">üì§ Guardar Copia</button>
                <button class="backup-btn" onclick="importData()">üì• Cargar Copia</button>
            </div>
        </div>
    </div>
</div>
<script>
    const curriculumData = [
        { semester: "I", subjects: [ { name: "Anatom√≠a Osteoarticular y Miolog√≠a", icon: "ü¶¥" }, { name: "Biolog√≠a Celular y Tisular", icon: "üî¨" }, { name: "Qu√≠mica General y Org√°nica", icon: "üß™" }, { name: "Matem√°tica B√°sica", icon: "‚ûó" }, { name: "T√©cnicas de la Com. Oral y Escrita", icon: "üó£Ô∏è" }, { name: "Intro a la Tecnolog√≠a M√©dica", icon: "ü©ª" } ] },
        { semester: "II", subjects: [ { name: "Anatom√≠a de Sistemas", icon: "ü´Ä" }, { name: "Fisiolog√≠a Humana", icon: "üèÉ" }, { name: "Bioqu√≠mica B√°sica", icon: "üß¨" }, { name: "Matem√°tica Intermedia", icon: "üìà" }, { name: "F√≠sica General I", icon: "üçé" }, { name: "Ingl√©s General", icon: "üá¨üáß" } ] },
        { semester: "III", subjects: [ { name: "Salud P√∫blica", icon: "üè•" }, { name: "Fisiopatolog√≠a Humana", icon: "ü§í" }, { name: "Enfermer√≠a B√°sica", icon: "üíâ" }, { name: "Matem√°tica Aplicada", icon: "üìê" }, { name: "F√≠sica General II", icon: "‚ö°" }, { name: "Ingl√©s T√©cnico", icon: "üìò" } ] },
        { semester: "IV", subjects: [ { name: "Fundamentos de Imagenolog√≠a", icon: "‚ò¢Ô∏è" }, { name: "Farmacolog√≠a B√°sica", icon: "üíä" }, { name: "Bio√©tica", icon: "‚öñÔ∏è" }, { name: "F√≠sica de las Radiaciones", icon: "‚öõÔ∏è" }, { name: "Electivo Formaci√≥n General", icon: "üé®" } ] },
        { semester: "V", subjects: [ { name: "Anatom√≠a Imagenol√≥gica", icon: "üíÄ" }, { name: "T√©cnicas Radiogr√°ficas I", icon: "üì∏" }, { name: "Bioestad√≠stica", icon: "üìä" }, { name: "Tecnolog√≠a Aplicada IMG", icon: "üíª" }, { name: "Intro a la F√≠sica Moderna", icon: "üåå" } ] },
        { semester: "VI", subjects: [ { name: "Patolog√≠a Imagenol√≥gica", icon: "ü¶†" }, { name: "T√©cnicas Radiogr√°ficas II", icon: "ü§≥" }, { name: "Metodolog√≠a de la Inv.", icon: "üìù" }, { name: "Protecci√≥n Radiol√≥gica", icon: "üõ°Ô∏è" }, { name: "Fundamentos F√≠sica M√©dica", icon: "üß≤" } ] },
        { semester: "VII", subjects: [ { name: "Cl√≠nica Radiol√≥gica I", icon: "ü©∫" }, { name: "Tomograf√≠a Computarizada", icon: "üç©" }, { name: "Resonancia Magn√©tica", icon: "üß≤" }, { name: "Garant√≠a de Calidad", icon: "‚úÖ" }, { name: "Seminario de Grado I", icon: "üéì" } ] },
        { semester: "VIII", subjects: [ { name: "Cl√≠nica Radiol√≥gica II", icon: "üè•" }, { name: "Gesti√≥n de Servicios", icon: "üíº" }, { name: "Mamograf√≠a y Ecotomograf√≠a", icon: "ü§±" }, { name: "Fundamentos Radiobiolog√≠a", icon: "üß¨" }, { name: "Seminario de Grado II", icon: "üéì" } ] },
        { semester: "IX", subjects: [ { name: "Cl√≠nica de Imagen", icon: "üë®‚Äç‚öïÔ∏è" }, { name: "Radioterapia", icon: "üéØ" }, { name: "Medicina Nuclear", icon: "‚ò¢Ô∏è" }, { name: "Electivo Formaci√≥n Pro.", icon: "üöÄ" } ] },
        { semester: "X", subjects: [ { name: "Actividad de Titulaci√≥n", icon: "üèÅ" } ] }
    ];
    const STORAGE_KEY = 'uta_malla_v9_backup';
    let savedState = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
    function init() { renderList(); renderYears(); updateGlobalProgress(); }
    function renderList() {
        const c = document.getElementById('gridContainer'); c.innerHTML = '';
        curriculumData.forEach((semData, idx) => {
            const col = document.createElement('div'); col.className = 'semester-col';
            col.innerHTML = `<div class="sem-header"><span class="sem-title">Sem ${semData.semester}</span><button class="btn-approve-sem" onclick="approveSemester(${idx})">APROBAR</button></div>`;
            let vis = 0;
            semData.subjects.forEach(subj => {
                const id = getSubjectId(idx, subj.name); const st = savedState[id] || 'pending'; if(st!=='pending') vis++;
                const card = document.createElement('div'); card.className = 'card'; card.setAttribute('data-status', st);
                card.innerHTML = `<div class="card-icon">${subj.icon}</div><div class="card-text">${subj.name}</div>`;
                card.onclick = () => toggleStatus(card, id); col.appendChild(card);
            });
            if(vis===0) col.classList.add('empty-semester'); else col.classList.remove('empty-semester');
            c.appendChild(col);
        });
    }
    function renderYears() {
        const yc = document.getElementById('yearsGrid'); yc.innerHTML = '';
        for (let i = 0; i < 5; i++) {
            const yCard = document.createElement('div'); yCard.className = 'year-card';
            yCard.innerHTML = `<div class="year-title">A√±o ${i+1}</div>`;
            const pairs = document.createElement('div'); pairs.className = 'sem-circles-pair';
            pairs.appendChild(createSemCircle(i*2));
            if(i*2+1 < curriculumData.length) pairs.appendChild(createSemCircle(i*2+1));
            yCard.appendChild(pairs); yc.appendChild(yCard);
        }
    }
    function createSemCircle(idx) {
        const d = curriculumData[idx]; let t=d.subjects.length, a=0, tk=0;
        d.subjects.forEach(s=>{ let st=savedState[getSubjectId(idx,s.name)]; if(st==='approved')a++; if(st==='taking')tk++; });
        let cl=''; if(a===t)cl='c-approved'; else if(a>0||tk>0)cl='c-taking';
        const el = document.createElement('div'); el.className = `sem-circle ${cl}`; el.innerHTML = `<span>SEM</span>${d.semester}`; return el;
    }
    function getSubjectId(i,n) { return `s${i}-${n.substring(0,10).replace(/\s/g,'')}`; }
    function toggleStatus(c,id) { const s=['pending','taking','approved']; const n=s[(s.indexOf(c.getAttribute('data-status'))+1)%3]; savedState[id]=n; saveAll(); }
    function approveSemester(i) { if(confirm('¬øAprobar Semestre?')) { curriculumData[i].subjects.forEach(s=>savedState[getSubjectId(i,s.name)]='approved'); saveAll(); } }
    function saveAll() { localStorage.setItem(STORAGE_KEY, JSON.stringify(savedState)); renderList(); renderYears(); updateGlobalProgress(); }
    function updateGlobalProgress() {
        let t=0, a=0; curriculumData.forEach((sem,i)=>sem.subjects.forEach(s=>{ t++; if(savedState[getSubjectId(i,s.name)]==='approved')a++; }));
        const p=Math.round((a/t)*100); document.getElementById('dashPercent').innerText=p+'%'; document.getElementById('dashFill').style.width=p+'%';
    }
    function switchView(v) {
        document.querySelectorAll('.btn').forEach(b=>b.classList.remove('active'));
        document.querySelectorAll('.view-section').forEach(s=>s.classList.remove('active'));
        if(v==='list'){ document.getElementById('btnList').classList.add('active'); document.getElementById('listView').classList.add('active'); document.getElementById('gridWrapper').classList.remove('summary-mode'); }
        else{ document.getElementById('btnYears').classList.add('active'); document.getElementById('yearsView').classList.add('active'); }
    }
    function toggleSummaryMode() { switchView('list'); const b=document.getElementById('btnSummary'); const a=document.getElementById('gridWrapper').classList.toggle('summary-mode'); if(a)b.classList.add('active'); else b.classList.remove('active'); }
    function resetAll() { if(confirm('¬øBorrar todo?')) { savedState={}; saveAll(); } }
    
    // BACKUP SYSTEM
    function exportData() {
        const str = btoa(JSON.stringify(savedState));
        prompt("Copia este c√≥digo y gu√°rdalo seguro:", str);
    }
    function importData() {
        const str = prompt("Pega tu c√≥digo de respaldo aqu√≠:");
        if(str) {
            try { savedState = JSON.parse(atob(str)); saveAll(); alert("¬°Datos recuperados!"); }
            catch(e) { alert("C√≥digo inv√°lido"); }
        }
    }
    init();
</script>
</body>
</html>